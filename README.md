# MySql-Nginx-Remote-Server-Setup

When we use reverse proxy for our VPS or VM it's really hard to manage MySql server at same machine.
Because of previous we used Xampp MySql. But now we want reverse proxy. Xampp use Apache server for their functionality.
Apache server bydefault runs on port 80! So, It makes conflict between Nginx and Apache.

So, how can we get access PhpMyAdmin in reverse proxy.

There is a way...
We need to install MySql Server and then install PhpMyAdmin without Xampp.

Let's start...

# MySql Install:
First,
Completely Uninstall MySQL Server in Ubuntu
sudo apt purge mysql-server*
ls /etc/mysql
sudo ls /var/lib/mysql
sudo rm -r /etc/mysql /var/lib/mysql 
sudo rm -r /var/log/mysql
sudo apt autoremove

sudo apt-get remove --purge mysql*
sudo apt-get autoremove
sudo apt-get autoclean

sudo apt install mysql-server

sudo service mysql start

sudo mysql
CREATE USER 'YourUserName'@'localhost' IDENTIFIED WITH caching_sha2_password BY 'YourDatabasePassword';
GRANT ALL PRIVILEGES ON *.* TO 'YourUserName'@'localhost' WITH GRANT OPTION;
exit


# Php Install:
sudo apt install php-fpm php-mysql


# PhpMyAdmin Install:
sudo apt-get -f install
sudo dpkg -P phpmyadmin  
sudo rm -vf /etc/apache2/conf.d/phpmyadmin.conf
sudo rm -vfR /usr/share/phpmyadmin
sudo service apache2 restart

sudo apt-get autoremove phpmyadmin
sudo apt update && sudo apt install phpmyadmin

Select Nothing
If you are prompted to choose a web server like below, as there is no option for Nginx, 
press TAB and then ENTER to continue without selecting a web server.
Then complete the install process.

# Nginx Setup:
Create a symlink
You’ll now need to create a symbolic link from the PHPMyAdmin files to Nginx’s document root directory. 
This will tell Nginx where PhpMyAdmin files are and how to serve them!

sudo ln -s /usr/share/phpmyadmin /var/www/html/phpmyadmin


Default.conf setup:
Add the following code in default.conf file.

##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
server {
	listen 80 default_server;
	listen [::]:80 default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root /var/www/html/phpmyadmin;

	# Add index.php to the list if you are using PHP
	index index.php index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;
	}

	# pass PHP scripts to FastCGI server
	#
	location ~ \.php$ {
		# include snippets/fastcgi-php.conf;
	
		# With php-fpm (or other unix sockets):
		fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
		# With php-cgi (or other tcp sockets):
		# fastcgi_pass 127.0.0.1:9000;
		include fastcgi_params;
		fastcgi_index index.php;
		fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
	}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}
}


# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
#server {
#	listen 80;
#	listen [::]:80;
#
#	server_name example.com;
#
#	root /var/www/example.com;
#	index index.html;
#
#	location / {
#		try_files $uri $uri/ =404;
#	}
#}


Then run the following command:
nginx -t
sudo service nginx restart

Then go to your IP address or domain and search:
yourdomain.com

Hope it works!



So, It's working fine...
Now we can set our database service in diffrent domain.
Everything is same. Just need to change yourdomain.com.conf file

First change the default.conf file as like when it was fresh installation.
Then add the Follow the code in your destination conf file.

server {

    server_name database.iare.network www.database.iare.network;

	root /var/www/html/phpmyadmin;

	# Add index.php to the list if you are using PHP
	index index.php index.html index.htm index.nginx-debian.html;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;
	}

	# pass PHP scripts to FastCGI server
	#
	location ~ \.php$ {
		# include snippets/fastcgi-php.conf;
	
		# With php-fpm (or other unix sockets):
		fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
		# With php-cgi (or other tcp sockets):
		# fastcgi_pass 127.0.0.1:9000;
		include fastcgi_params;
		fastcgi_index index.php;
		fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
	}

}



Then, Create a symlink (follow previous command)
nginx -t
sudo service nginx restart


Let's Enjoy...
